<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Recipe</title>
    <link rel="stylesheet" type="text/css" href="recipe.css">
</head>
<body>

    <header OnClick="location.href='https://haori.kmuwink.com'">
        <div>
            <p class="BigText">하</p><p class="SmallText">루</p>
        </div>
        <div>
            <p class="BigText">오</p><p class="SmallText">분</p>
        </div>
        <div>
            <p class="SmallText">요</p><p class="BigText">리</p>
        </div>
    </header>
    <div class="clear">
        <span class="subTitle">바쁜 하루 한 끼라도 제대로 요리해 먹자 !</span>
    </div>
    <img id="haoriFace" src="./Img/HaoriFaceIcon.svg" alt="하오리 얼굴 아이콘">
    <main>
        <div class="mainHeader">
            <img class="exampleImage" src="" alt="요리 예시">
            <div class="recipeIntro">
                <h1 class="recipeName"></h1>
                <p class="meterials"></p>
                <div>
                    <p class="cookingTime">조리 시간 : 20분</p>
                    <p class="cookingLevel">실력 레벨 : 초보환영</p>
                </div>
            </div>
        </div>
        <div class="recipeDetail"></div>
        <div class="tip">
          <h1>더 맛있게 먹는 Tip !</h1>
          <p></p>
        </div>
        <div class="recommendHeart">
            <button id="Heart" onclick="like();"></button>
        </div>
    </main>
    <div class="icon">
        <img id=haoriIcon src="./Img/HaoriIcon.svg" alt="하오리아이콘">
    </div>
    <footer>
        <span>Copyright &copyright 2020 H0zzae</span>
    </footer>
    <script>
        let likeClicked = false;
        function like(){
            if (!likeClicked){
                let likeNum = document.querySelector('.recommendHeart p');
                document.querySelector('#Heart').style.transition = 'background 1s';
                document.querySelector('#Heart').style.background = 'url("./Img/clickedHeart.svg") no-repeat';
                document.querySelector('#Heart').style.backgroundSize = 'contain';
                document.querySelector('#Heart').style.outline = 'none';
                likeClicked = true;
            }
        }
        async function main(){
            const url = location.href;
            const videoId= url.slice(url.indexOf('?')+1, url.length).split('=')[1];
            const fetchurl ='https://www.googleapis.com/youtube/v3/videos?part=snippet&id='+videoId+'&key=AIzaSyAu4tqResCBND7Lc7QYc7SpxLyCX0N_2y4';
            const responseData = await (await fetch(fetchurl)).json();

            const thumbnails = responseData.items[0].snippet.thumbnails.maxres.url;
            document.querySelector('.exampleImage').src = thumbnails;
            const menuTitle = responseData.items[0].snippet.title;
            document.querySelector('.recipeName').innerHTML = menuTitle;

            const description = responseData.items[0].snippet.description;
            let array = description.split(']');
            const metarial = array[1];
            let meterials = document.querySelector('.meterials');
            meterials.innerHTML = '재료 :'+metarial.split('[')[0];

            const recipeDetail = array[2];
            let rd = document.querySelector('.recipeDetail');
            let recipeArray = recipeDetail.split('다.');
            for (let i=0;i<recipeArray.length-1; i++){
                if (recipeArray[i].includes('Tip')){
                    if (recipeArray[i].includes('Tip. ')){
                        document.querySelector('.tip p').innerHTML +='* '+recipeArray[i].split('Tip. ')[1]+'다.'+'<br>';
                    }
                    else if(recipeArray[i].includes('Tip: ')){
                        document.querySelector('.tip p').innerHTML +='* '+recipeArray[i].split('Tip: ')[1]+'다.'+'<br>';
                    }
                }
                else{
                    rd.innerHTML+= recipeArray[i]+'다.'+'<br>';
                }
            }
        }
        main();
    </script>
</body>
</html>